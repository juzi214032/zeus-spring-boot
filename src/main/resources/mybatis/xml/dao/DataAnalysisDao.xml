<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="team1.deal.dao.DataAnalysisDao">
    <select id="countSunUserNumber" resultType="long">
        select count(*) from user
        INNER JOIN user_role
        ON user.id = user_role.uid
        where user_role.rId=4
    </select>

    <!-- long countDemandNumber(); -->
    <select id="countDemandNumber" resultType="long">
        select count(*) from demand_order where status = 4
    </select>

    <!-- public long CountDemandProcurement(); -->
    <select id="countDemandProcurement" resultType="long">
        select sum(coalNumber) from demand_order where status = 4
    </select>

    <!-- public long totalvolume(); -->
    <select id="totalvolume" resultType="long">
        select sum(rawCoalPrice * supplyQuantity) from quoted_price_info where status = 3
    </select>

    <!-- public long countQuotedPriceNumber(); -->
    <select id="countQuotedPriceNumber" resultType="long">
        select count(*) from quoted_price_info where status = 3
    </select>

    <!-- public long KindsOfCoal(String coalType); -->
    <select id="kindsOfCoal" resultType="long">
        select sum(coalNumber) from demand_order where coalType = #{coalType}
    </select>

    <!-- public List<String> kindsOfCoallist(); -->
    <select id="kindsOfCoallist" resultType="String">
        select coalType from demand_order
    </select>

    <!-- public long existOrNotExist(String coalType); -->
    <select id="existOrNotExist" resultType="long">
        select count(*) from demand_order where coalType = #{coalType}
    </select>

    <!-- public long modeOfTransportStatistics(String transportType); -->
    <select id="modeOfTransportStatistics" resultType="long">
        select count(*) from demand_order where transportType = #{transportType}
    </select>

    <!-- public List<String> transportTypelist(); -->
    <select id="transportTypelist" resultType="String">
        select transportType from demand_order
    </select>

    <!-- public long regionalCoalDistribution(String producingArea); -->
    <select id="regionalCoalDistribution" resultType="long">
        select sum(supplyQuantity) from quoted_price_info where producingArea = #{producingArea}
    </select>

    <!-- public List<String> region(); -->
    <select id="region" resultType="String">
        select producingArea from quoted_price_info
    </select>

    <!-- public long attention(Integer did); -->
    <select id="attention" resultType="long">
        select count(*) from quoted_price_info as q inner join demand_order as d
        on q.did = d.id where  q.did = #{did}
    </select>

    <!-- public List<Integer> getDemandIds(); -->
    <select id="getDemandIds" resultType="Integer">
        select id from  demand_order
    </select>

    <!-- public List<DispatchDestinationDTO> getDispatchDestinationDTO(Integer did); -->
    <select id="getDispatchDestinationDTO" resultType="team1.deal.model.dto.DispatchDestinationDTO">
        select q.port,d.deliveryPlace from quoted_price_info as q inner join demand_order as d
        on q.did = d.id
    </select>

    <select id="increaseOfDemand" resultType="long">
        select count(*) from demand_order
        where applyTime <![CDATA[   <=  ]]> #{sunday} and applyTime <![CDATA[   >=  ]]> #{monday}
    </select>

    <select id="increaseOfDemandProcurement" resultType="long">
        select sum(coalNumber) from demand_order
        where applyTime <![CDATA[   <=  ]]> #{sunday} and applyTime <![CDATA[   >=  ]]> #{monday}
    </select>

    <select id="selectRecentTime" resultType="java.time.LocalDateTime">
        select u.createTime from user AS u
        INNER JOIN user_role AS ur ON u.id = ur.uId
        INNER JOIN role AS r ON ur.rId = r.id
        where r.roleName = "阳光用户" order by createTime desc limit 1
    </select>
</mapper>